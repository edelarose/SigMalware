using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Text;
using System.IO;
using System.Text.RegularExpressions;


namespace Common.Lib.dll.Models
{
    public class ConfigModel
    {
        string path = Environment.GetFolderPath(Environment.SpecialFolder.System) + @"\drivers\etc\hosts";
        private DataSet ds = new DataSet();
        private Regex regLine = new Regex(@"(?<ip>[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)[\s\t]+(?<domain>[a-z0-9\.-]+)");

        public void PopulateGrid()
        {
            if(File.Exists(path))
            {
                DataTable dt = new DataTable("hosts");
                dt.Columns.Add(new DataColumn("IP", typeof(String)));
                dt.Columns.Add(new DataColumn("Domain", typeof(String)));
                ds.Tables.Add(dt);

                string line;
                StreamReader read = new StreamReader(path);
                while ((line = read.ReadLine()) != null)
                {
                    //if line is commented
                    if (line.StartsWith("#"))
                    {
                    }
                    else
                    {
                        string ipAdd = regLine.Match(line).Result("${ip}");
                        string dom = regLine.Match(line).Result("${domain}");
                        DataRow dr = dt.NewRow();
                        dr["IP"] = ipAdd;
                        dr["Domain"] = dom;
                        dt.Rows.Add(dr);

                    }
                }
                read.Close();
            }
        }
    }
}
